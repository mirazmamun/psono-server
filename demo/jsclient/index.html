<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>JS Client</title>

    <!-- All of the following lines in head are kinda mandatory -->

    <!-- SCrypt and sha512 are mandatory -->
    <script src="libs/scrypt/browser/scrypt.js" type="text/javascript"></script>
    <script src="//crypto-js.googlecode.com/svn/tags/3.1.2/build/rollups/sha512.js" type="text/javascript"></script>

    <!-- Main Script -->
    <script src="client.js" type="text/javascript"></script>

    <!-- Jquery is used for all REST-API Calls -->
    <script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>

    <!-- Helper functions to call the actual functions with form parameters and display the output -->
    <script type="text/javascript">
        $(function () {
            (function () {
                "use strict";

                var client = new ClassClient();

                /*
                 *  Registraiton
                 */

                $('#generate_authkey_button_registration').click(function (event) {
                    event.preventDefault();
                    // do the magic
                    $('#authkey_registration').val(
                            client.generate_authkey($('#email_registration').val(), $('#password_registration').val())
                    );
                });

                $('#registration_submitbutton').click(function (event) {
                    event.preventDefault();
                    // do the magic, function will return a promise so handle it
                    client.authentication_register($('#email_registration').val(), $('#authkey_registration').val())
                        .done(function(value) {
                            // Registration was successful
                            $('#registration_request_feedback').val(value);
                        })
                        .fail(function(value) {
                            // Registration failed
                            $('#registration_request_feedback').val(value.responseText);
                        });
                });
                /*
                 *  Verify E-Mail
                 */

                $('#verify_email_button').click(function (event) {
                    event.preventDefault();
                    // do the magic, function will return a promise so handle it
                    client.authentication_verify_email($('#activation_code').val())
                        .done(function(value) {
                            // E-Mail verification was successful
                            $('#email_verification_request_feedback').val(value);
                        })
                        .fail(function(value) {
                            // E-Mail verification failed
                            $('#email_verification_request_feedback').val(value.responseText);
                        });
                });


                /*
                 *  Login
                 */

                $('#generate_authkey_button_login').click(function (event) {
                    event.preventDefault();
                    // do the magic
                    $('#authkey_login').val(
                            client.generate_authkey($('#email_login').val(), $('#password_login').val())
                    );
                });
                

                $('#login_submitbutton').click(function (event) {
                    event.preventDefault();
                    // do the magic, function will return a promise so handle it
                    client.authentication_login($('#email_login').val(), $('#authkey_login').val())
                        .done(function(value) {
                            // Login successful
                            $('#login_request_feedback').val(value);
                        })
                        .fail(function(value) {
                            // Login failed
                            $('#login_request_feedback').val(value.responseText);
                        });
                });


                /*
                 *  Logout
                 */


                $('#logout_submitbutton').click(function (event) {
                    event.preventDefault();
                    // do the magic, function will return a promise so handle it
                    client.authentication_logout($('#token_logout').val())
                        .done(function(value) {
                            // Logout successful
                            $('#logout_request_feedback').val(value);
                        })
                        .fail(function(value) {
                            // Logout failed
                            $('#logout_request_feedback').val(value.responseText);
                        });
                });


                /*
                 *  Read Datastores
                 */


                $('#read_datastore').click(function (event) {
                    event.preventDefault();
                    // do the magic, function will return a promise so handle it
                    client.read_datastore($('#token_datastore_read').val())
                        .done(function(value) {
                            // successful
                            $('#the_datastore_read').val(value);
                        })
                        .fail(function(value) {
                            // failed
                            $('#the_datastore_read').val(value.responseText);
                        });
                });


                $('#read_datastore_id').click(function (event) {
                    event.preventDefault();
                    // do the magic, function will return a promise so handle it
                    client.read_datastore($('#token_datastore_read_id').val(), $('#id_datastore_read_id').val())
                        .done(function(value) {
                            // successful
                            $('#the_datastore_read_id').val(value);
                        })
                        .fail(function(value) {
                            // failed
                            $('#the_datastore_read_id').val(value.responseText);
                        });
                });


                /*
                 *  Write Datastore
                 */


                $('#write_datastore').click(function (event) {
                    event.preventDefault();
                    // do the magic, function will return a promise so handle it
                    client.write_datastore($('#token_datastore_write').val(), $('#id_datastore_write_id').val(), $('#the_datastore_write').val())
                        .done(function(value) {
                            // successful
                            $('#datastore_write_request_feedback').val(value);
                        })
                        .fail(function(value) {
                            // failed
                            $('#datastore_write_request_feedback').val(value.responseText);
                        });
                });

            }());
        });

    </script>


    <!-- All of the following lines in head are only for styling -->

    <!-- JQuery UI is only used for some nice styling -->
    <link rel="stylesheet" href="//ajax.googleapis.com/ajax/libs/jqueryui/1.11.4/themes/smoothness/jquery-ui.css">
    <script src="//ajax.googleapis.com/ajax/libs/jqueryui/1.11.4/jquery-ui.min.js"></script>

    <!-- Just some Styles, not necessary :D  -->
    <style>
        .ui-widget {
            font-size: 0.9em;
        }
        section {
            margin: 20px;
        }

        section h3 {
            margin-left: -20px;
        }
    </style>

    <!-- Just some JS for JQuery UI styling, not necessary :D  -->
    <script>
        $(function () {
            $("#tabs").tabs();
        });
    </script>


</head>
<body>
<form>
    <h1>JS Client</h1>

    <p>This is a small demo client for the password manager in JavaScript</p>


    <div id="tabs">
        <ul>
            <li><a href="#tabs-1">Registration</a></li>
            <li><a href="#tabs-2">Verify Email</a></li>
            <li><a href="#tabs-3">Login</a></li>
            <li><a href="#tabs-4">Logout</a></li>
            <li><a href="#tabs-5">Read Datastore</a></li>
            <li><a href="#tabs-6">Write Datastore</a></li>
        </ul>
        <div id="tabs-1">
            <!-- START Registration -->
            <section>
                <h3>Step 1</h3>

                <p>Email and password are taken to generate the authkey for registration </p>
                <h4>INPUT: </h4>
                <label for="email_registration">E-Mail: </label><input size="30" type="email" name="email_registration"
                                                                       id="email_registration" value="Test@test.com">
                <label for="password_registration">Password: </label><input size="30" type="text"
                                                                            name="password_registration"
                                                                            id="password_registration"
                                                                            value="myPassword">
                <br/>
                <INPUT type="button" name="button" value="1. Generate Login Token: generate_authkey(email, password)"
                       id="generate_authkey_button_registration"/>
                <br/>
                <h4>OUTPUT: </h4>
                <label for="authkey_registration">Authkey: </label>
                <br/>
                <textarea rows="4" cols="60" name="authkey_registration" id="authkey_registration" readonly></textarea>
                <br/>
                <small>It should be the following for "Test@test.com" and "myPassword":<br/>365bd57f7c0c0578eceeb0135e2c07d7dc0e0fb695e09737ca93fa738c4e0efbe94b4b811909749a76e401ea0d3cc6c2bda84f8d08c414a4080c8a5fbdadd3e4
                </small>
            </section>

            <hr>

            <section>
                <h3>Step 2</h3>

                <p>
                    Email and authkey (from step 1) are used to register with the server (Endpoint
                    <a href="/authentication/registration/">/authentication/registration/</a>)
                </p>

                <INPUT type="button" name="button"
                       value="2. Query the server for registration: register(email, authkey)"
                       id="registration_submitbutton"/>
                <br/>
                <h4>OUTPUT: </h4>
                <label for="registration_request_feedback">Registration Request Feedback: </label>
                <br/>
                <textarea rows="4" cols="60" name="registration_request_feedback" id="registration_request_feedback" readonly></textarea>
                <br/>
                <small>Will return a success message or an error. An email with an email_verification_code is sent to the provided email address.
                </small>

            </section>
            <!-- END Registration -->
        </div>




        <div id="tabs-2">
            <!-- START Verify E-Mail -->
            <section>
                <h3>Step 1</h3>

                <p>Takes the activation_code that has been sent to the user via E-Mail and activates the account (Endpoint
                    <a href="/authentication/login/">/authentication/verify-email/</a>)</p>
                <h4>INPUT: </h4>
                <label for="activation_code">Activation Code: </label><input size="180" type="text" name="activation_code"
                                                                id="activation_code"
                                                                value="">
                <br/>
                <INPUT type="button" name="button" value="1. Activates the email: verify_email(activation_code)"
                       id="verify_email_button"/>
                <br/>
                <h4>OUTPUT: </h4>
                <label for="email_verification_request_feedback">Login Verification Feedback: </label>
                <br/>
                <textarea rows="4" cols="60" name="email_verification_request_feedback" id="email_verification_request_feedback" readonly></textarea>
                <br/>
                <small>Will return nothing except a success or fail message
                </small>
            </section>
            <!-- END Verify E-Mail -->
        </div>




        <div id="tabs-3">
            <!-- START Login -->
            <section>
                <h3>Step 1</h3>

                <p>Email and password are taken to generate the authkey for login (same as in registration)</p>
                <h4>INPUT: </h4>
                <label for="email_login">E-Mail: </label><input size="30" type="email" name="email_login"
                                                                id="email_login"
                                                                value="Test@test.com">
                <label for="password_login">Password: </label><input size="30" type="text" name="password_login"
                                                                     id="password_login" value="myPassword">
                <br/>
                <INPUT type="button" name="button" value="1. Generate Login Token: generate_authkey(email, password)"
                       id="generate_authkey_button_login"/>
                <br/>
                <h4>OUTPUT: </h4>
                <label for="authkey_login">Authkey: </label>
                <br/>
                <textarea rows="4" cols="60" name="authkey_login" id="authkey_login" readonly></textarea>
                <br/>
                <small>It should be the following for "Test@test.com" and "myPassword":<br/>365bd57f7c0c0578eceeb0135e2c07d7dc0e0fb695e09737ca93fa738c4e0efbe94b4b811909749a76e401ea0d3cc6c2bda84f8d08c414a4080c8a5fbdadd3e4
                </small>
            </section>

            <hr>

            <section>
                <h3>Step 2</h3>

                <p>
                    Email and authkey (from step 1) are used to login to the server (Endpoint
                    <a href="/authentication/login/">/authentication/login/</a>) and get a token back for further
                    authentication
                </p>

                <INPUT type="button" name="button"
                       value="2. Query the server for login: login(email, authkey)"
                       id="login_submitbutton"/>
                <br/>
                <h4>OUTPUT: </h4>
                <label for="login_request_feedback">Login Request Feedback: </label>
                <br/>
                <textarea rows="4" cols="60" name="login_request_feedback" id="login_request_feedback" readonly></textarea>
                <br/>
                <small>Will return the token for further authentication
                </small>

            </section>
            <!-- END Login -->
        </div>




        <div id="tabs-4">
            <!-- START Logout -->
            <section>
                <h3>Step 1</h3>

                <p>Use the token from login to logout</p>
                <h4>INPUT: </h4>
                <label for="token_logout">Token: </label><input size="30" size="180" type="text" name="token_logout"
                                                                id="token_logout"
                                                                value="">
                <br/>
                <INPUT type="button" name="button" value="1. Logout: logout(token)"
                       id="logout_submitbutton"/>
                <br/>
                <h4>OUTPUT: </h4>
                <label for="logout_request_feedback">Datastore: </label>
                <br/>
                <textarea rows="4" cols="60" name="logout_request_feedback" id="logout_request_feedback" readonly></textarea>
                <br/>
                <small>
                </small>
            </section>
            <!-- END Logout -->
        </div>




        <div id="tabs-5">
            <!-- START Read Datastore -->
            <section>
                <h3>Step 1</h3>

                <p>Use the token from login to get a list of all datastores</p>
                <h4>INPUT: </h4>
                <label for="token_datastore_read">Token: </label><input size="30" size="180" type="text" name="token_datastore_read"
                                                                id="token_datastore_read"
                                                                value="">
                <br/>
                <INPUT type="button" name="button" value="1. Get datastore list: read_datastore(token)"
                       id="read_datastore"/>
                <br/>
                <h4>OUTPUT: </h4>
                <label for="the_datastore_read">Datastore: </label>
                <br/>
                <textarea rows="4" cols="60" name="the_datastore_read" id="the_datastore_read" readonly></textarea>
                <br/>
                <small>
                </small>
            </section>

            <hr>

            <section>
                <h3>Step 2</h3>

                <p>Use the token from login and the datastore ID to get the datastore's content</p>
                <h4>INPUT: </h4>
                <label for="token_datastore_read_id">Token: </label><input size="30" size="180" type="text" name="token_datastore_read_id"
                                                                id="token_datastore_read_id"
                                                                value="">
                <br/>
                <label for="id_datastore_read_id">Datastore ID: </label><input size="30" size="180" type="text" name="id_datastore_read_id"
                                                                id="id_datastore_read_id"
                                                                value="">
                <br/>
                <INPUT type="button" name="button" value="1. Read one datastores content: read_datastore(token, datastore_id)"
                       id="read_datastore_id"/>
                <br/>
                <h4>OUTPUT: </h4>
                <label for="the_datastore_read_id">Datastore: </label>
                <br/>
                <textarea rows="4" cols="60" name="the_datastore_read_id" id="the_datastore_read_id" readonly></textarea>
                <br/>
                <small>No final decision has yet been made about the structure of the datastore, but the idea is that clients filter according to type
                </small>
            </section>
            <!-- END Read Datastore -->
        </div>




        <div id="tabs-6">
            <!-- START Write Datastore -->
            <section>
                <h3>Step 1</h3>

                <p>Use the token from login to get the datastore</p>
                <h4>INPUT: </h4>
                <label for="token_datastore_write">Token: </label><input size="30" size="180" type="text" name="token_datastore_write"
                                                                id="token_datastore_write"
                                                                value="">
                <br/>
                <label for="id_datastore_write_id">Datastore ID: </label><input size="30" size="180" type="text" name="id_datastore_write_id"
                                                                id="id_datastore_write_id"
                                                                value="">
                <br/>
                <label for="the_datastore_write">Datastore: </label>
                <br/>
                <textarea rows="4" cols="60" name="the_datastore_write" id="the_datastore_write"></textarea>
                <br/>
                <small>You can only change the data value for now.
                </small>
                <br/>
                <INPUT type="button" name="button" value="1. Write the datastore: write_datastore(token, datastore)"
                       id="write_datastore"/>
                <br/>
                <h4>OUTPUT: </h4>
                <label for="datastore_write_request_feedback">Datastore: </label>
                <br/>
                <textarea rows="4" cols="60" name="datastore_write_request_feedback" id="datastore_write_request_feedback" readonly></textarea>
                <small>
                </small>
            </section>
            <!-- END Write Datastore -->
        </div>

    </div>
</form>

</body>
</html>
