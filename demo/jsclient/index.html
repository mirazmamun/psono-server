<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>JS Client</title>

    <!-- All of the following lines in head are kinda mandatory -->

    <!-- SCrypt and sha512 are mandatory -->
    <script src="libs/scrypt/browser/scrypt.js" type="text/javascript"></script>
    <script src="//crypto-js.googlecode.com/svn/tags/3.1.2/build/rollups/sha512.js" type="text/javascript"></script>

    <!-- Main Script -->
    <script src="client.js" type="text/javascript"></script>

    <!-- Jquery is used for all REST-API Calls -->
    <script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>

    <!-- Helper functions to call the actual functions with form parameters and display the output -->
    <script type="text/javascript">
        $(function () {
            (function () {
                "use strict";

                /*
                 *  Registraiton
                 */

                $('#generate_authkey_button_registration').click(function (event) {
                    event.preventDefault();
                    // do the magic
                    $('#authkey_registration').val(
                            client.generate_authkey($('#email_registration').val(), $('#password_registration').val())
                    );
                });

                $('#registration_submitbutton').click(function (event) {
                    event.preventDefault();
                    // do the magic, function will return a promise so handle it
                    client.authentication_register($('#email_registration').val(), $('#authkey_registration').val())
                        .done(function(value) {
                            // Registration was successful
                            $('#registration_request_feedback').val(value);
                        })
                        .fail(function(value) {
                            // Registration failed
                            $('#registration_request_feedback').val(value.responseText);
                        });
                });
                /*
                 *  Verify E-Mail
                 */

                $('#verify_email_button').click(function (event) {
                    event.preventDefault();
                    // do the magic, function will return a promise so handle it
                    client.authentication_verify_email($('#activation_code').val())
                        .done(function(value) {
                            // E-Mail verification was successful
                            $('#email_verification_request_feedback').val(value);
                        })
                        .fail(function(value) {
                            // E-Mail verification failed
                            $('#email_verification_request_feedback').val(value.responseText);
                        });
                });


                /*
                 *  Login
                 */

                $('#generate_authkey_button_login').click(function (event) {
                    event.preventDefault();
                    // do the magic
                    $('#authkey_login').val(
                            client.generate_authkey($('#email_login').val(), $('#password_login').val())
                    );
                });
                

                $('#login_submitbutton').click(function (event) {
                    event.preventDefault();
                    // do the magic, function will return a promise so handle it
                    client.authentication_login($('#email_login').val(), $('#authkey_login').val())
                        .done(function(value) {
                            // Login was successful
                            $('#login_request_feedback').val(value);
                        })
                        .fail(function(value) {
                            // Login failed
                            $('#login_request_feedback').val(value.responseText);
                        });
                });
            }());
        });

    </script>


    <!-- All of the following lines in head are only for styling -->

    <!-- JQuery UI is only used for some nice styling -->
    <link rel="stylesheet" href="//ajax.googleapis.com/ajax/libs/jqueryui/1.11.4/themes/smoothness/jquery-ui.css">
    <script src="//ajax.googleapis.com/ajax/libs/jqueryui/1.11.4/jquery-ui.min.js"></script>

    <!-- Just some Styles, not necessary :D  -->
    <style>
        .ui-widget {
            font-size: 0.9em;
        }
        section {
            margin: 20px;
        }

        section h3 {
            margin-left: -20px;
        }
    </style>

    <!-- Just some JS for JQuery UI styling, not necessary :D  -->
    <script>
        $(function () {
            $("#tabs").tabs();
        });
    </script>


</head>
<body>
<form>
    <h1>JS Client</h1>

    <p>This is a small demo client for the password manager in JavaScript</p>


    <div id="tabs">
        <ul>
            <li><a href="#tabs-1">Registration</a></li>
            <li><a href="#tabs-2">Verify Email</a></li>
            <li><a href="#tabs-3">Login</a></li>
        </ul>
        <div id="tabs-1">
            <!-- START Registration -->
            <section>
                <h3>Step 1</h3>

                <p>Email and password are taken to generate the authkey for registration </p>
                <h4>INPUT: </h4>
                <label for="email_registration">E-Mail: </label><input size="30" type="email" name="email_registration"
                                                                       id="email_registration" value="Test@test.com">
                <label for="password_registration">Password: </label><input size="30" type="text"
                                                                            name="password_registration"
                                                                            id="password_registration"
                                                                            value="myPassword">
                <br/>
                <INPUT type="button" name="button" value="1. Generate Login Token: generate_authkey(email, password)"
                       id="generate_authkey_button_registration"/>
                <br/>
                <h4>OUTPUT: </h4>
                <label for="authkey_registration">Loginauthkey: </label>
                <br/>
                <textarea rows="4" cols="60" name="authkey_registration" id="authkey_registration" readonly></textarea>
                <br/>
                <small>It should be the following for "Test@test.com" and "myPassword":<br/>365bd57f7c0c0578eceeb0135e2c07d7dc0e0fb695e09737ca93fa738c4e0efbe94b4b811909749a76e401ea0d3cc6c2bda84f8d08c414a4080c8a5fbdadd3e4
                </small>
            </section>

            <hr>

            <section>
                <h3>Step 2</h3>

                <p>
                    Email and authkey (from step 1) are used to register with the server (Endpoint
                    <a href="/authentication/registration/">/authentication/registration/</a>)
                </p>

                <INPUT type="button" name="button"
                       value="2. Query the server for registration: register(email, authkey)"
                       id="registration_submitbutton"/>
                <br/>
                <h4>OUTPUT: </h4>
                <label for="registration_request_feedback">Registration Request Feedback: </label>
                <br/>
                <textarea rows="4" cols="60" name="registration_request_feedback" id="registration_request_feedback" readonly></textarea>
                <br/>
                <small>Will return a success message or an error. An email with an email_verification_code is sent to the provided email address.
                </small>

            </section>
            <!-- END Registration -->
        </div>




        <div id="tabs-2">
            <!-- START Verify E-Mail -->
            <section>
                <h3>Step 1</h3>

                <p>Takes the activation_code that has been sent to the user via E-Mail and activates the account (Endpoint
                    <a href="/authentication/login/">/authentication/verify-email/</a>)</p>
                <h4>INPUT: </h4>
                <label for="activation_code">Activation Code: </label><input size="180" type="text" name="activation_code"
                                                                id="activation_code"
                                                                value="">
                <br/>
                <INPUT type="button" name="button" value="1. Activates the email: verify_email(activation_code)"
                       id="verify_email_button"/>
                <br/>
                <h4>OUTPUT: </h4>
                <label for="email_verification_request_feedback">Login Verification Feedback: </label>
                <br/>
                <textarea rows="4" cols="60" name="email_verification_request_feedback" id="email_verification_request_feedback" readonly></textarea>
                <br/>
                <small>Will return nothing except a success or fail message
                </small>
            </section>
            <!-- END Verify E-Mail -->
        </div>




        <div id="tabs-3">
            <!-- START Login -->
            <section>
                <h3>Step 1</h3>

                <p>Email and password are taken to generate the authkey for login (same as in registration)</p>
                <h4>INPUT: </h4>
                <label for="email_login">E-Mail: </label><input size="30" type="email" name="email_login"
                                                                id="email_login"
                                                                value="Test@test.com">
                <label for="password_login">Password: </label><input size="30" type="text" name="password_login"
                                                                     id="password_login" value="myPassword">
                <br/>
                <INPUT type="button" name="button" value="1. Generate Login Token: generate_authkey(email, password)"
                       id="generate_authkey_button_login"/>
                <br/>
                <h4>OUTPUT: </h4>
                <label for="authkey_login">Loginauthkey: </label>
                <br/>
                <textarea rows="4" cols="60" name="authkey_login" id="authkey_login" readonly></textarea>
                <br/>
                <small>It should be the following for "Test@test.com" and "myPassword":<br/>365bd57f7c0c0578eceeb0135e2c07d7dc0e0fb695e09737ca93fa738c4e0efbe94b4b811909749a76e401ea0d3cc6c2bda84f8d08c414a4080c8a5fbdadd3e4
                </small>
            </section>

            <hr>

            <section>
                <h3>Step 2</h3>

                <p>
                    Email and authkey (from step 1) are used to login to the server (Endpoint
                    <a href="/authentication/login/">/authentication/login/</a>) and get a token back for further
                    authentication
                </p>

                <INPUT type="button" name="button"
                       value="2. Query the server for login: login(email, authkey)"
                       id="login_submitbutton"/>
                <br/>
                <h4>OUTPUT: </h4>
                <label for="login_request_feedback">Login Request Feedback: </label>
                <br/>
                <textarea rows="4" cols="60" name="login_request_feedback" id="login_request_feedback" readonly></textarea>
                <br/>
                <small>Will return the token for further authentication
                </small>

            </section>
            <!-- END Login -->
        </div>
    </div>


</form>

</body>
</html>
